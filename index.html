<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulación Rebote de Dos Pelotas</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      margin: 0;
      background: linear-gradient(to top, #004466, #e6f7ff);
      font-family: Arial, sans-serif;
      color: #000;
    }
    h1 {
      margin: 10px;
      font-size: 1.4rem;
      text-align: center;
      color: #fff;
      text-shadow: 1px 1px 2px #000;
    }
    #controls {
      margin: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      align-items: center;
    }
    fieldset {
      border: 1px solid rgba(255,255,255,0.4);
      border-radius: 10px;
      padding: 8px 10px 10px;
      min-width: 260px;
    }
    legend {
      font-weight: bold;
      color: #fff;
      text-shadow: 1px 1px 1px #000;
      padding: 0 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .dot {
      display: inline-block;
      width: 10px; height: 10px;
      border-radius: 50%;
      box-shadow: 0 0 0 1px rgba(0,0,0,0.25);
    }
    .dot.red { background: #ff4d4d; }
    .dot.green { background: #32cd32; }

    label {
      font-size: 0.9rem;
      font-weight: bold;
      color: #fff;
      text-shadow: 1px 1px 1px #000;
      margin-right: 4px;
    }
    input, button {
      padding: 6px 10px;
      border-radius: 6px;
      border: none;
      font-size: 1rem;
    }
    input {
      width: 70px;
      text-align: center;
      margin-right: 8px;
    }
    button {
      background: #ff6600;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 1px 1px 3px rgba(0,0,0,0.4);
    }
    button:hover { background: #e65c00; }

    #contenedor {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      width: 100%;
      max-width: 620px;
      padding: 10px;
    }
    #simulacion {
      position: relative;
      width: 100%;
      max-width: 480px;
      height: 400px;
      border: 2px solid #333;
      background: #fafafa;
      overflow: hidden;
      border-radius: 10px;
    }
    .pelota {
      position: absolute;
      bottom: 0;
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }
    #pelota1 { left: 30%; background: radial-gradient(circle at 10px 10px, #ff5555, #aa0000); }
    #pelota2 { left: 70%; background: radial-gradient(circle at 10px 10px, #55ff55, #00aa00); }

    #energia {
      margin-top: 5px;
      font-weight: bold;
      text-align: center;
      font-size: 0.9rem;
      background: rgba(255,255,255,0.8);
      padding: 8px;
      border-radius: 6px;
      box-shadow: 1px 1px 4px rgba(0,0,0,0.3);
      max-width: 480px;
    }

    #graficos {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      width: 100%;
      max-width: 620px;
    }
    @media (min-width: 600px){ #graficos { grid-template-columns: 1fr 1fr; } }
    .grafico-card {
      background: #fff;
      border-radius: 8px;
      padding: 6px;
      box-shadow: 1px 1px 4px rgba(0,0,0,0.3);
      height: 210px;
      display: flex;
      flex-direction: column;
    }
    .grafico-titulo {
      font-size: 0.9rem;
      font-weight: bold;
      margin: 2px 4px 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    canvas { width: 100% !important; height: 170px !important; }

    /* Modal */
    #modalOverlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 16px;
      z-index: 999;
    }
    #modalCard {
      background: #ffffff;
      max-width: 520px;
      width: 100%;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.35);
      overflow: hidden;
    }
    #modalHeader {
      background: #004466;
      color: #fff;
      padding: 10px 14px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    #modalBody {
      padding: 12px 14px;
      line-height: 1.55;
      font-size: 0.98rem;
    }
    #modalBody .pel-row {
      display: flex; align-items: center; gap: 8px; margin: 6px 0;
    }
    #modalFooter {
      padding: 10px 14px;
      display: flex; gap: 8px; justify-content: flex-end;
      background: #f5f7fa;
    }
    .btn-secondary {
      background: #6b7280; color: #fff;
    }
    .btn-secondary:hover { background: #5b6470; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>Simulación de Rebote de Dos Pelotas</h1>

  <div id="controls">
    <fieldset>
      <legend><span class="dot red"></span> Pelota 1 (roja)</legend>
      <label for="altura1">Altura (m):</label>
      <input type="number" id="altura1" value="5" min="1" max="20">
      <label for="masa1">Masa (kg):</label>
      <input type="number" id="masa1" value="1" min="0.1" step="0.1">
    </fieldset>

    <fieldset>
      <legend><span class="dot green"></span> Pelota 2 (verde)</legend>
      <label for="altura2">Altura (m):</label>
      <input type="number" id="altura2" value="8" min="1" max="20">
      <label for="masa2">Masa (kg):</label>
      <input type="number" id="masa2" value="0.5" min="0.1" step="0.1">
    </fieldset>

    <button onclick="iniciarSimulacion()">Iniciar</button>
    <button id="pauseBtn" onclick="togglePausa()">Pausar</button>
  </div>

  <div id="contenedor">
    <div id="simulacion">
      <div id="pelota1" class="pelota"></div>
      <div id="pelota2" class="pelota"></div>
    </div>

    <div id="energia">
      Energía Potencial (total): - <br>
      Energía Cinética (total): - <br>
      Energía Mecánica Total (suma): -
    </div>

    <div id="graficos">
      <div class="grafico-card">
        <div class="grafico-titulo"><span class="dot red"></span> Energías — Pelota 1 (roja)</div>
        <canvas id="grafico1"></canvas>
      </div>
      <div class="grafico-card">
        <div class="grafico-titulo"><span class="dot green"></span> Energías — Pelota 2 (verde)</div>
        <canvas id="grafico2"></canvas>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div id="modalOverlay">
    <div id="modalCard">
      <div id="modalHeader">
        <span id="modalTitle">Estado actual de energías</span>
        <button class="btn-secondary" onclick="cerrarModal()">Cerrar</button>
      </div>
      <div id="modalBody">
        <div class="pel-row"><span class="dot red"></span><strong>Pelota 1 (roja)</strong></div>
        <div id="infoP1"></div>
        <hr>
        <div class="pel-row"><span class="dot green"></span><strong>Pelota 2 (verde)</strong></div>
        <div id="infoP2"></div>
      </div>
      <div id="modalFooter">
        <button class="btn-secondary" onclick="cerrarModal()">Cerrar</button>
        <button onclick="reanudarDesdeModal()">Reanudar</button>
      </div>
    </div>
  </div>

  <script>
    const g = 9.8;
    const escala = 50;
    let animacion, pelotas = [], energiaTexto, paused = false;
    let chart1, chart2, chartData1, chartData2;
    let maxEnergia1 = 0, maxEnergia2 = 0;

    function iniciarSimulacion() {
      cancelAnimationFrame(animacion);
      paused = false;
      document.getElementById('pauseBtn').textContent = 'Pausar';
      document.getElementById('modalOverlay').style.display = 'none';

      const altura1 = parseFloat(document.getElementById("altura1").value);
      const masa1   = parseFloat(document.getElementById("masa1").value);
      const altura2 = parseFloat(document.getElementById("altura2").value);
      const masa2   = parseFloat(document.getElementById("masa2").value);

      pelotas = [
        { altura: altura1, velocidad: 0, masa: masa1, elem: document.getElementById("pelota1") },
        { altura: altura2, velocidad: 0, masa: masa2, elem: document.getElementById("pelota2") }
      ];

      maxEnergia1 = masa1 * g * altura1;
      maxEnergia2 = masa2 * g * altura2;

      energiaTexto = document.getElementById("energia");

      inicializarGraficos();
      actualizarEnergia();
      animar();
    }

    function inicializarGraficos() {
      const ctx1 = document.getElementById("grafico1").getContext("2d");
      const ctx2 = document.getElementById("grafico2").getContext("2d");
      if (chart1) chart1.destroy();
      if (chart2) chart2.destroy();
      chartData1 = { labels: ["EPOT", "ECIN", "EMEC"], datasets: [{ data: [0,0,0], backgroundColor: ["#33cc33", "#3399ff", "#ff9933"] }] };
      chartData2 = { labels: ["EPOT", "ECIN", "EMEC"], datasets: [{ data: [0,0,0], backgroundColor: ["#33cc33", "#3399ff", "#ff9933"] }] };
      chart1 = new Chart(ctx1,{ type:"bar", data:chartData1, options:{ animation:false, scales:{y:{beginAtZero:true,max:maxEnergia1}}, plugins:{legend:{display:false}} }});
      chart2 = new Chart(ctx2,{ type:"bar", data:chartData2, options:{ animation:false, scales:{y:{beginAtZero:true,max:maxEnergia2}}, plugins:{legend:{display:false}} }});
    }

    function actualizarEnergia() {
      const pot1 = pelotas[0].masa * g * pelotas[0].altura;
      const cin1 = 0.5 * pelotas[0].masa * pelotas[0].velocidad ** 2;
      const mec1 = pot1 + cin1;
      const pot2 = pelotas[1].masa * g * pelotas[1].altura;
      const cin2 = 0.5 * pelotas[1].masa * pelotas[1].velocidad ** 2;
      const mec2 = pot2 + cin2;

      const potT = pot1 + pot2, cinT = cin1 + cin2, mecT = mec1 + mec2;
      energiaTexto.innerHTML = `Energía Potencial (total): ${potT.toFixed(2)} J<br>
        Energía Cinética (total): ${cinT.toFixed(2)} J<br>
        Energía Mecánica Total (suma): ${mecT.toFixed(2)} J`;

      chartData1.datasets[0].data = [pot1, cin1, mec1]; chart1.update();
      chartData2.datasets[0].data = [pot2, cin2, mec2]; chart2.update();
    }

    function animar() {
      if (paused) return;
      pelotas.forEach(p=>{
        p.velocidad -= g*0.02;
        p.altura += p.velocidad*0.02;
        if(p.altura<=0){ p.altura=0; p.velocidad=-p.velocidad*0.7; if(Math.abs(p.velocidad)<0.5) p.velocidad=0; }
        p.elem.style.bottom=(p.altura*escala)+"px";
      });
      actualizarEnergia();
      animacion=requestAnimationFrame(animar);
    }

    function togglePausa() {
      paused=!paused;
      const btn=document.getElementById('pauseBtn');
      if(paused){ btn.textContent='Reanudar'; mostrarModalConEnergias(); }
      else { document.getElementById('modalOverlay').style.display='none'; animar(); }
    }
    function reanudarDesdeModal(){ paused=false; document.getElementById('pauseBtn').textContent='Pausar'; document.getElementById('modalOverlay').style.display='none'; animar();}
    function cerrarModal(){ document.getElementById('modalOverlay').style.display='none'; }

    function mostrarModalConEnergias(){
      const pot1=pelotas[0].masa*g*pelotas[0].altura, cin1=0.5*pelotas[0].masa*pelotas[0].velocidad**2, mec1=pot1+cin1;
      const pot2=pelotas[1].masa*g*pelotas[1].altura, cin2=0.5*pelotas[1].masa*pelotas[1].velocidad**2, mec2=pot2+cin2;
      const fmt=x=>x.toFixed(2);
      document.getElementById('infoP1').innerHTML=
        `Altura: <strong>${fmt(pelotas[0].altura)}</strong> m | Velocidad: <strong>${fmt(pelotas[0].velocidad)}</strong> m/s<br>
         EPOT: <strong>${fmt(pot1)}</strong> J | ECIN: <strong>${fmt(cin1)}</strong> J | EMEC: <strong>${fmt(mec1)}</strong> J`;
      document.getElementById('infoP2').innerHTML=
        `Altura: <strong>${fmt(pelotas[1].altura)}</strong> m | Velocidad: <strong>${fmt(pelotas[1].velocidad)}</strong> m/s<br>
         EPOT: <strong>${fmt(pot2)}</strong> J | ECIN: <strong>${fmt(cin2)}</strong> J | EMEC: <strong>${fmt(mec2)}</strong> J`;
      document.getElementById('modalOverlay').style.display='flex';
    }
  </script>
</body>
</html>
